<!-- Build Java clients for EBI web services. -->
<project name="EBIWS2-Java" basedir="." default="jar">
	<property name="src.dir" value="src" />
	<property name="jdispatcher.src.dir" value="${src.dir}/uk/ac/ebi/webservices/jdispatcher" />
	<property name="build.dir" value="bin" />
	<property name="lib.dir" value="lib"/>
	<property name="jar.dir" value="jar"/>

  <!-- Add all jars in lib/ to classpath -->
  <path id="classpath">
    <fileset dir="${lib.dir}" includes="**/*.jar"/>
  </path>

  <!-- Clean-up build directory -->
  <target name="clean">
    <delete includeemptydirs="true">
      <fileset dir="${build.dir}" includes="**/*"/>
    </delete>
  </target>

  <!-- Get back to distributed/repository state -->
  <target name="distclean" depends="clean,distclean-lib,distclean-stubs">
  </target>

	<target name="distclean-lib">
	    <delete includeemptydirs="true" quiet="true">
	        <fileset dir="." includes="lib**.zip"/>
    	    <fileset dir="${lib.dir}/" includes="*/**"/>
        	<fileset dir="." includes="${lib.dir}"/>
	    </delete>
	</target>
	
	<target name="distclean-stubs">
		<antcall target="distclean-stubs-clustalw2" />
		<antcall target="distclean-stubs-fasta" />
		<antcall target="distclean-stubs-ncbiblast" />
		<antcall target="distclean-stubs-wublast" />
	</target>
	
	<target name="distclean-stubs-clustalw2" depends="distclean-stubs-clustalw2-msa,distclean-stubs-clustalw2-phylotree">
	    <delete includeemptydirs="true" quiet="true">
	        <fileset dir="${jdispatcher.src.dir}/clustalw2" includes="*/**" />
	        <fileset dir="${jdispatcher.src.dir}/" includes="clustalw2" />
	    </delete>
	</target>
	
	<target name="distclean-stubs-clustalw2-msa">
	    <delete includeemptydirs="true" quiet="true">
	        <fileset dir="${jdispatcher.src.dir}/clustalw2/msa" includes="*/**" />
	        <fileset dir="${jdispatcher.src.dir}/clustalw2" includes="msa" />
	    </delete>
	</target>

	<target name="distclean-stubs-clustalw2-phylotree">
	    <delete includeemptydirs="true" quiet="true">
	        <fileset dir="${jdispatcher.src.dir}/clustalw2/phylotree" includes="*/**" />
	        <fileset dir="${jdispatcher.src.dir}/clustalw2" includes="phylotree" />
	    </delete>
	</target>

	<target name="distclean-stubs-fasta">
	    <delete includeemptydirs="true" quiet="true">
	        <fileset dir="${jdispatcher.src.dir}/fasta" includes="*/**" />
	        <fileset dir="${jdispatcher.src.dir}/" includes="fasta" />
	    </delete>
	</target>

	<target name="distclean-stubs-ncbiblast">
	    <delete includeemptydirs="true" quiet="true">
	        <fileset dir="${jdispatcher.src.dir}/ncbiblast" includes="*/**" />
	        <fileset dir="${jdispatcher.src.dir}/" includes="ncbiblast" />
	    </delete>
	</target>

	<target name="distclean-stubs-wublast">
	    <delete includeemptydirs="true" quiet="true">
	        <fileset dir="${jdispatcher.src.dir}/wublast" includes="*/**" />
	        <fileset dir="${jdispatcher.src.dir}/" includes="wublast" />
	    </delete>
	</target>

  <!-- Get dependencies archive, includes Axis 1.4, Axis 2 and JAX-RPC libraries -->
  <target name="get-dependencies">
    <get src="http://www.ebi.ac.uk/Tools/webservices/downloads/java/lib-1.4.zip"
	 dest="lib-1.4.zip" />
  </target>

  <!-- Unpack dependencies archive -->
  <target name="unpack-dependencies" depends="get-dependencies">
    <unzip src="lib-1.4.zip" dest="." />
  </target>

  <!-- Generate stubs from a WSDL -->
  <target name="genStubs">
    <echo message="${stubPkg}" />
    <echo message="${wsdlUrl}" />
    <java classname="org.apache.axis.wsdl.WSDL2Java"
	  classpathref="classpath"
	  fork="yes"
	  dir="${src.dir}">
      <arg value="-p" />
      <arg value="${stubPkg}" />
      <arg value="${wsdlUrl}" />
    </java>
  </target>

  <!-- Generate stubs for all services -->
  <target name="stubs-all" depends="unpack-dependencies">
    <!-- <antcall target="stubs-clustalw2" /> -->
    <antcall target="stubs-fasta" />
    <antcall target="stubs-ncbiblast" />
    <antcall target="stubs-wublast" />
  </target>

	<!-- Generate stubs for each service -->
	<target name="stubs-clustalw2">
		<antcall target="stubs-clustalw2-msa" />
		<antcall target="stubs-clustalw2-phylotree" />
	</target>
	<target name="stubs-clustalw2-msa">
		<antcall target="genStubs">
	    	<param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.clustalw2.msa" />
	    	<param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/services/soap/clustalw2-msa?wsdl" />
		</antcall>
	</target>
	  <target name="stubs-clustalw2-phylotree">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.clustalw2.phylotree" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/services/soap/clustalw2-phylotree?wsdl" />
	    </antcall>
	  </target>
	  <target name="stubs-fasta">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.fasta" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/services/soap/fasta?wsdl" />
	    </antcall>
	  </target>
	  <target name="stubs-ncbiblast">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.ncbiblast" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/services/soap/ncbiblast?wsdl" />
	    </antcall>
	  </target>
	  <target name="stubs-wublast">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.wublast" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/services/soap/wublast?wsdl" />
	    </antcall>
	  </target>

  <!-- Compile code into classes -->
  <target name="compile">
    <javac
      srcdir="${src.dir}"
      destdir="${build.dir}"
      classpathref="classpath"
    />
  </target>

  <!-- Package jars -->
  <target name="jar" depends="compile">
    <!-- <jar destfile="${jar.dir}/ClustalW2.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/ClustalW2Client.** uk/ac/ebi/webservices/jdispatcher/clustalw2/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.ClustalW2Client"/>
     </manifest>
   </jar> -->
    <jar destfile="${jar.dir}/Fasta.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/FastaClient.** uk/ac/ebi/webservices/jdispatcher/AbstractWsClient.** uk/ac/ebi/webservices/jdispatcher/fasta/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.FastaClient"/>
     </manifest>
   </jar>
    <jar destfile="${jar.dir}/NCBIBlast.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/NCBIBlastClient.** uk/ac/ebi/webservices/jdispatcher/AbstractWsClient.** uk/ac/ebi/webservices/jdispatcher/ncbiblast/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.NCBIBlastClient"/>
     </manifest>
   </jar>
    <jar destfile="${jar.dir}/WUBlast.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/WUBlastClient.** uk/ac/ebi/webservices/jdispatcher/AbstractWsClient.** uk/ac/ebi/webservices/jdispatcher/wublast/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.WUBlastClient"/>
     </manifest>
   </jar>
  </target>

	<!-- Test clients -->
	<target name="test" depends="jar">
	    <ant dir="test" inheritAll="false" />
	</target>
</project>
